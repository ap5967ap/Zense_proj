{% extends 'base.html' %}


{% block content %}
{% load static  %}
<div class="container pt-5" style="background: none no-repeat scroll 0 0 #fff;position:relative">
    <div class="row">
    <div class="col container " style="align-items: center; justify-content:center" >
        <h3 style="font-family: 'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;">Here, is the summary of your income over all years.</h3>
        <h3 id='xx' style="font-family: 'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;">This, year income is .</h3>
    </div>
    
    
    </div>
    <div>
    <canvas 
      id="myChart"
      class="col-md-6 row"
      url-endpoint="{% url 'income_summary_data' %}"
    ></canvas>
  </div>
  <br><br>
  <div>
    <canvas
      id="infla"
      class="col-md-6 row "
      url-endpoint="{% url 'income_summary_data' %}"
    ></canvas>
  </div>
</div>

<script>
    var endpoint = "{% url 'income_summary_data' %}";
    var defaultData = [];
    var labels = []
$.ajax({
    method: "GET",
    url: endpoint,
    success: function (data) {
      console.log(data);
      if (data.error){
        alert("You have not added any income source yet. Please add some income source to see the summary.")
        window.location.href = "{% url 'add_income' %}";
      }
      infla(data, "infla");
      graph(data, "myChart");
      x=document.getElementById('xx')
      x.textContent = "This year income is Rs. " +  data.inc[data.inc.length -1] 
    
    },
    error: function (err) {
      console.log("error");
      console.log(err);
    },
  });
  function graph(data, id) {
    var labels = data.l2;
    var chartLabel = data.l2;
    var chartdata = data.value;
    var ctx = document.getElementById(id).getContext("2d");

    var chart = new Chart(ctx, {
      type: "doughnut",
      data: {
        labels: chartLabel,
        datasets: [
          {
            label: "Contribution",
            borderColor: "black",
            backgroundColor:["rgba(255,0,0,1)", "rgba(0,0,255,1)", "rgba(0,255,0,1)", "rgba(255,255,0,1)", "rgba(255,165,0,1)", "rgba(128,0,128,1)", "rgba(165,42,42,1)", "rgba(255,192,203,1)", "rgba(128,128,128,1)", "rgba(0,255,255,1)"],
            data: chartdata,
            hoverOffset: 4,
            hoverBackgroundColor:["rgba(255,0,0,0.78)", "rgba(0,0,255,0.78)", "rgba(0,255,0,0.78)", "rgba(255,255,0,0.78)", "rgba(255,165,0,0.78)", "rgba(128,0,128,0.78)", "rgba(165,42,42,0.78)", "rgba(255,192,203,0.78)", "rgba(128,128,128,0.78)", "rgba(0,255,255,0.78)"]
          },
        ],
      },
      options:{
        title: {
            display: true,
            text: 'Contribution of Various sources in Income'
          },
      }
    },
    );
  }
  function infla(data, id) {
    var labels = data.labels;
    var ctx = document.getElementById(id).getContext("2d");
    var options={
        title: {
            display: true,
            text: 'Income over Years -  Growth and Inflation'
          },
       
      scales: {
        yAxes: [
          {
            id:'ya',
            type: "linear",
            ticks: {
              beginAtZero: true,
              fontSize:14,
              fontColor:'black',
            },
          },
          {
            position:'right',
            id:'yb',
            type: "linear",
            ticks: {
              beginAtZero: true,
              fontSize:14,
              fontColor:'black',
            },
          }
        ],
      },
    }
    
    var chart = new Chart(ctx, {
      type: "bar",
      data: {
        datasets: [
          {
            label: "Previous Year Incomes",
            data: data.inc,
            borderColor: "green",
            backgroundColor: "rgba(99,255,100,0.7)",
            borderWidth: 2,
            yAxisID:'ya'
          },
          {
            label: "Growth",
            data: data.growth,
            type: "line",
            backgroundColor: "rgba(255,99,132,0.2)",
            lineTension: 0.4,
            borderColor: "rgba(255,99,132,0.9)",
            yAxisID:'yb'
          },
          {
            label: "Inflation",
            data: data.infla,
            type: "line",
            backgroundColor: "rgba(13,99,255,0.2)",
            lineTension: 0.4,
            borderColor: "rgba(13,99,255,0.9)",
            yAxisID:'yb'
          },
        ],
        labels: data.labels,
      },
      options:options
    });
  }
 


</script>


{% endblock content %}