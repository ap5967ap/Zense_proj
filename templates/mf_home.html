{% extends 'base.html' %} {% block content %}
<div class="container">
  <div class="row">
    This year you have invested Rs. {{this_year_invest}} in Mutual Funds.
</div>
<div class="row">
    Your total portfolio value is Rs. {{total}} in Mutual Fund.
</div>
</div>
<div class="container pt-5">
    <table class="table table-striped">
        <thead>
        <tr>
            <th scope="col">Name of the Mutual Fund</th>
            <th scope="col">Quantity Bought till date</th>
            <th scope="col">Average buying price</th>
            <th scope="col">Start Date</th>
            <th scope="col">Next date</th>
            <th scope="col">SIP or Lumsum</th>
        </tr>
        </thead>
        <tbody>
            {% for i,j in dict.items %}
        <tr>
            <td><a href="{% url 'mf_single' j.3 %}">{{j.3}}</a></td>
            <td>{{j.0}}</td>
            <td>{{j.1}}</td>
            <td>{{j.2}}</td>
            <td>{{j.5}}</td>
            {% if j.4 %}
            <td>SIP</td>
            {% else %}
            <td>Lumsum</td>
            {% endif %}
            <td><form method="get" action="{% url 'mf_transact' %}">
                <input type="hidden" name="name" value="{{i}}">
                <button type="submit" class="btn btn-success">Buy</button>
            </form>
            </td>
            <td><form method='get' action="{% url 'mf_sell' %}">
                <input type="hidden" name="name" value="{{i}}">
                <button type="submit" class="btn btn-danger">Sell</button>
            </form></td>
            {% endfor %}
        </tr>
        </tbody>
    </table>
</div>
<br>
<br>
<div class="container">
    <canvas
      id="myChart"
      class="col-md-6 row"
      url-endpoint="{% url 'mf_prev' %}">

    </canvas>
  </div>
  <script>
    var endpoint = "{% url 'mf_prev' %}";
    var defaultData = [];
    var labels = [];
    $.ajax({
    method: "GET",
    url: endpoint,
    success: function (data) {
        console.log(data);
        graph(data, "myChart");
    },
    error: function (err) {
        console.log("error");
        console.log(err);
    },
    });
    function graph(data, id) {
        var myData = {
          labels: data.year,
          datasets: [
            {
              type: "bar",
              label:"Year",
              data: data.mf,
              fill: true,
              borderColor: "rgba(255, 159, 64,1)",
              backgroundColor: "rgba(255, 159, 64, 0.2)",
                borderWidth: 1,
            },
          ],
        };
        var options={
            scales: {
                yAxes: [{
                    type: 'linear',
                    position: 'left',
                    ticks: {
                        beginAtZero: true,
                        fontSize:14,
                        fontColor: "black",
                        callback: function(value, index, values) {
                            return value.toLocaleString("en-IN",{style:"currency", currency:"INR"});
                        },
                    }
                }]
            }
        }
        var ctx = document.getElementById(id).getContext("2d");
        var chart = new Chart(ctx, {
          type: "bar",
          data: myData,
            options:options,
        });
      }
  </script>
{% endblock content %}
